<html>

<head>
    <meta charset="UTF-8">
    <title>Voice Calculator</title>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.9.0/p5.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.9.0/addons/p5.dom.min.js"></script>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
    <script src="https://unpkg.com/ml5@latest/dist/ml5.min.js" type="text/javascript"></script>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Raleway:300,300i,400,400i,500,500i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i" rel="stylesheet">
    <!--    <script src="detectSoundscript.js"></script>-->
    <!--    <link href="style.css" rel="stylesheet">-->
</head>
<style>
    body {
        font-family: "Open Sans", sans-serif;
        color: #FFFFFF;
    }
    h1, h2, h3, h4, h5, h6,p {
        font-family: "Open Sans", sans-serif;
    }
    div {
        outline-color: darkblue;
    }
    div.ridge {
        outline-style: ridge;
    }
    body {
        background: linear-gradient(#b1b1ff, #6262ff);
    }
</style>
<script>
    // Initialize a sound classifier method with SpeechCommands18w model. A callback needs to be passed.
    let classifier;
    var arrayOfInputs = ["zero","one","two","three","four","five","six","seven","eight","nine"];
    var currentNumTotal = 1;
    // Options for the SpeechCommands18w model, the default probabilityThreshold is 0
    const options = { probabilityThreshold: 0.7 };
    // Two variable to hold the label and confidence of the result


    function preload() {
        // Load SpeechCommands18w sound classifier model
        classifier = ml5.soundClassifier('SpeechCommands18w', options);
    }
    var operationSelected;
    // function selectOperation(){
    //     operationSelected = document.getElementById("btn-primary").value;
    //     alert(operationSelected);
    //     classifier.classify(gotResult);// Classify the sound from microphone in real time
    // }

    $(document).ready(function () {
        $("button").click(function () {
            var operationSelectedID = this.value;
            operationSelected = operationSelectedID;
            classifier.classify(gotResult);// Classify the sound from microphone in real time
        });
    });

    function setup() {
        noCanvas();
        // Create 'label' and 'confidence' div to hold results


    }

    // A function to run when we get any errors and the results
    function gotResult(error, results) {
        // Display error in the console
        if (error) {
            console.error(error);
        }
        // The results are in an array ordered by confidence.
        console.log(results);
        // Show the first label and confidence
        // label.html('Label: ' + results[0].label);
        convertNums(results[0].label);
        document.getElementById("confidenceID").textContent = "Confidence: " + nf(results[0].confidence, 0, 2);

        // confidence.html('Confidence: ' + nf(results[0].confidence, 0, 2)); // Round the confidence to 0.01
    }

    function convertNums(input){
        var numRightNow = 0;
        for(let x=0;x<11;x++){
            if(arrayOfInputs[x] == input){
                numRightNow = x;
            }
        }

        if(numRightNow != 0){
            performOperation(numRightNow)
        }


    }
    function performOperation(input){
        if(operationSelected == "add"){
            currentNumTotal += input;
        }
        else if(operationSelected == "sub"){
            currentNumTotal -= input;
        }
        else if(operationSelected == "divide"){
            currentNumTotal /= input;
        }
        else if(operationSelected == "multiply"){
            currentNumTotal *= input;
        }
        else{
        }
        checkForInfinity();

        document.getElementById("totalID").textContent = "Total: " + currentNumTotal;

    }
    function checkForInfinity(){
        if(currentNumTotal == Infinity){
            currentNumTotal = 1;
        }

    }
</script>
<body>
<center>
    <h1>Voice Calculator</h1>
    <p><i>The Calculator which actually listens!</i></p>
    <h4>
        <b>INSTRUCTIONS</b>
        <br><br>
        <li>Select an Operation</li>
        <li>Speak a digit 1-9 with one second breaks in between</li>
        <li>Watch the Operation Occur!</li>
        <br>
        <li>Note: Single Digit Operations are supported as of now</li>
    </h4>

    <div class="btn-group">
        <button value="add" style="font-size: 3vh" type="button" id="opp[0]" class="btn-primary">+</button>
        <button value="sub" style="font-size: 3vh" type="button" id="opp[1]" class="btn-primary">-</button>
        <br>

    </div>
    <br>
    <br>
    <div class="btn-group">
        <button value="divide" style="font-size: 3vh" type="button" id="opp[2]" class="btn-primary">/</button>
        <button value="multiply" style="font-size: 3vh" type="button" id="opp[3]" class="btn-primary">*</button>
    </div>

    <br>
    <br>
    <h3>Results</h3>
    <div class="ridge">
        <h4 id="totalID"><b>Total: </b> (Available After Operation Clicked)</h4>
        <br>
        <h4 id="confidenceID"><b>Confidence: </b> (Available After Operation Clicked)</h4>

    </div>
    <br>
    <br>
    <h3>How it Works</h3>
    <div class="ridge">
        <h4><b>Overview: </b><br>A model is pre-trained with audio samples of different words such as numbers in this program.</h4>
        <h4><b>How Does the Classifier Actually Work: </b> <br>In reality the processing of training the model on sound is very similar to image classification! You may be wondering that sound and images are two seperate data formats/things in general. Well, the idea is the same for there is still a Convolutional neural network, but instead of labeling images, audio is being labeled with an optimal confidence score. Here is where is gets super cool now, that audio is being labeled as an image, for a sample of audio is taken, say from 0 seconds to 5 seconds, and is represented in a spectrogram format - a visual representation of the various frequencies. Using that image we have now of the spectrogram, we can now classify it in a very similar manner to classifying images using a CNN which extracts different data to train our model to recognize the pattern of matching certain frequencies to specific words like the number one. </h4>
        <div class="column__cell column__image column__right">
            <img src="../assets/img/webProjectsImages/soundclassifiervisual.png" />
        </div>
        <h4><b>What is the Confidence Level?: </b><br>The confidence level represents how confident the trained model is on the prediction made. For example, say you say the number "three", it will classify the audio and predict three and have a confidence value.</h4>

    </div>
    <br>
</center>

<footer>
    <center>
        <div class="copyright">
            &copy; Copyright <strong><span>Rayaan Siddiqi</span></strong>
            <br>
            <p>All Rights Reserved</p>
        </div>
    </center>
</footer>


</body>

</html>